# Backend Requirements
# Flask + PySpark + Gunicorn fÃ¼r Railway

Flask==3.0.0
Flask-CORS==4.0.0
pyspark==3.5.0
pandas==2.1.4
gunicorn==21.2.0

# ZusÃ¤tzliche Dependencies fÃ¼r Production
python-dotenv==1.0.0
# ğŸš€ Backend Deployment auf Railway - Schritt fÃ¼r Schritt

## âœ… Voraussetzungen
- âœ… Backend-Code ist auf GitHub: `https://github.com/SebastianKuehnrich/Backend_Pyspark_Dashboard.git`
- âœ… Railway Account erstellt

---

## ğŸ“¦ 1. Railway Projekt erstellen

1. Gehe zu: https://railway.app/dashboard
2. Klicke auf **"New Project"**
3. WÃ¤hle **"Deploy from GitHub repo"**
4. WÃ¤hle: `Backend_Pyspark_Dashboard`

---

## âš™ï¸ 2. Projekt-Settings konfigurieren

### Root Directory (WICHTIG!)
Da dies ein Monorepo sein kÃ¶nnte, stelle sicher:
- **Settings** â†’ **Root Directory**: `.` (oder leer lassen, da Backend im Root liegt)

### Build Command
Railway erkennt automatisch die `nixpacks.toml` - kein manuelles Build-Command nÃ¶tig!

---

## ğŸŒ 3. Environment Variables setzen

**Settings** â†’ **Variables** â†’ Folgende hinzufÃ¼gen:

```env
PYTHONUNBUFFERED=1
FLASK_ENV=production
PORT=8000
```

Optional (fÃ¼r CORS):
```env
FRONTEND_URL=https://pysparkkundenanalysedashboard-production.up.railway.app
```

---

## ğŸš€ 4. Deploy starten

1. Railway startet automatisch das Deployment
2. **Build-Prozess** (ca. 2-5 Minuten):
   - Python 3.11 installieren
   - OpenJDK 17 installieren (fÃ¼r PySpark)
   - Dependencies aus `backend_requirements.txt` installieren
   - Gunicorn Server starten

3. **Logs Ã¼berprÃ¼fen**:
   - Klicke auf **"View Logs"**
   - Sollte anzeigen: `âœ… Build erfolgreich abgeschlossen!`

---

## ğŸ”— 5. Backend-URL erhalten

Nach erfolgreichem Deployment:
1. **Settings** â†’ **Networking** â†’ **Public Networking**
2. Klicke auf **"Generate Domain"**
3. Notiere die URL, z.B.: `https://backend-production-xyz.up.railway.app`

---

## ğŸ“ 6. Backend-URL im Frontend eintragen

### Option A: Ãœber Railway Environment Variable (Empfohlen)
1. Gehe zum **Frontend-Service** auf Railway
2. **Settings** â†’ **Variables**
3. FÃ¼ge hinzu:
   ```
   VITE_API_URL=https://deine-backend-url.up.railway.app
   ```
4. **Redeploy** triggern

### Option B: In Code-Datei
Datei: `frontend/.env.production`
```env
VITE_API_URL=https://deine-backend-url.up.railway.app
```
Dann zu GitHub pushen und Railway deployed automatisch neu.

---

## ğŸ§ª 7. Testen

### Backend-Status prÃ¼fen:
```
https://deine-backend-url.up.railway.app/api/status
```

Sollte zurÃ¼ckgeben:
```json
{
  "status": "online",
  "version": "1.0.0",
  "timestamp": "2025-12-02T..."
}
```

### CSV-Upload testen:
Ã–ffne das Frontend und lade eine CSV-Datei hoch.

---

## ğŸ› Troubleshooting

### Problem: "Build failed" - PySpark Installation
**LÃ¶sung**: Memory erhÃ¶hen
- Settings â†’ Resources â†’ Memory: **4GB** (statt 512MB)

### Problem: "Timeout beim CSV-Upload"
**LÃ¶sung**: Worker-Timeout erhÃ¶hen in `nixpacks.toml`:
```toml
cmd = "gunicorn --timeout 600 ..."
```

### Problem: "CORS Error" im Frontend
**LÃ¶sung**: CORS-Origins im Backend anpassen:
```python
CORS(app, origins=[
    'https://pysparkkundenanalysedashboard-production.up.railway.app',
    'http://localhost:5173'
])
```

---

## ğŸ“Š Resource Requirements (Railway)

**Empfohlene Einstellungen:**
- **Memory**: 4GB (wegen PySpark)
- **CPU**: 2 vCPUs
- **Disk**: 1GB (fÃ¼r temporÃ¤re CSV-Dateien)

---

## âœ… Checkliste

- [ ] Backend auf Railway deployed
- [ ] Backend-URL notiert
- [ ] Backend-Status-Endpoint funktioniert (`/api/status`)
- [ ] Frontend Environment Variable gesetzt (`VITE_API_URL`)
- [ ] Frontend neu deployed
- [ ] CSV-Upload getestet

---

**Bei Problemen**: PrÃ¼fe die Railway Build-Logs fÃ¼r detaillierte Fehlermeldungen!

